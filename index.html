<html><head><base href="." /><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Restaurant Analysis</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"><script src="https://cdn.jsdelivr.net/npm/flatpickr"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script><script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script><style>body {font-family: Arial, sans-serif;margin: 0;padding: 15px;background-color: #f5f5f5;}.container {background: white;padding: 15px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);margin-bottom: 20px;width: 100%;box-sizing: border-box;}.chart-container {height: 400px;margin: 20px 0;width: 100%;position: relative;}.graph-controls {position: absolute;top: 10px;right: 10px;display: flex;gap: 5px;z-index: 10;}.download-button {cursor: pointer;display: flex;align-items: center;justify-content: center;width: 30px;height: 30px;}.pie-charts-container {display: flex;flex-wrap: wrap;gap: 20px;margin-top: 20px;justify-content: space-between;}.pie-chart-container {flex: 1 1 calc(33.333% - 20px);min-width: 250px;height: 300px;position: relative;}h1, h2 {color: #333;text-align: center;font-size: clamp(1.5rem, 4vw, 2.5rem);}.controls {display: flex;gap: 10px;margin: 20px 0;justify-content: center;flex-wrap: wrap;}select, input {padding: 8px;border-radius: 4px;border: 1px solid #ddd;max-width: 100%;min-width: 200px;}.date-selector {position: relative;display: flex;align-items: center;justify-content: center;gap: 10px;}.date-selector .calendar-icon {position: absolute;right: calc(50% - 90px);top: 50%;transform: translateY(-50%);width: 20px;height: 20px;pointer-events: none;}.dwell-time {display: none;}.date-selector #datePicker {padding: 8px;border-radius: 4px;border: 1px solid #ddd;width: 100%;max-width: 200px;text-align: center;}.tab-container {width: 100%;margin-top: 20px;}.tab-buttons {display: flex;gap: 10px;margin-bottom: 20px;flex-wrap: wrap;justify-content: center;}.tab-button {padding: 10px 20px;background: #f5f5f5;border: 2px solid #2f7622;border-radius: 4px;cursor: pointer;color: #2f7622;font-weight: bold;white-space: nowrap;}.tab-button.active {background: #2f7622;color: white;}.tab-content {display: none;}.tab-content.active {display: block;}.checkbox-label {display: flex;align-items: center;gap: 5px;cursor: pointer;white-space: nowrap;}#column2 {transition: opacity 0.3s;}#column2.hidden {display: none;}.time-range-selector {margin: 20px 0;text-align: center;width: 100%;}.time-range-selector input[type="range"] {width: 100%;max-width: 300px;margin: 10px 0;}.time-periods-legend {margin: 20px auto;max-width: 600px;}.time-periods-table {flex: 1 1 calc(33.333% - 20px);min-width: 250px;margin-top: 0;border-collapse: collapse;}.time-periods-table th,.time-periods-table td {padding: 8px;border: 1px solid #ddd;text-align: left;vertical-align: middle;}.time-periods-table th {background-color: #f5f5f5;}.color-indicator {width: 20px;height: 20px;border-radius: 50%;display: inline-block;margin-right: 10px;vertical-align: middle;}.top-stats-container {display: flex;gap: 20px;margin-top: 20px;justify-content: center;}.stats-box {background: rgba(255, 255, 255, 0.1);padding: 20px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);flex: 1;min-width: 250px;max-width: 300px;}.stats-box h3 {color: #333;margin-top: 0;font-size: 1.1rem;text-align: center;margin-bottom: 15px;}.stats-box ul {list-style: none;padding: 0;margin: 0;}.stats-box li {padding: 10px;margin-bottom: 8px;background: #f5f5f5;border-radius: 4px;display: flex;justify-content: space-between;align-items: center;}.stats-box li:last-child {margin-bottom: 0;}.top-banner {background: #2f7622;padding: 20px;margin-bottom: 20px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);color: white;}.stats-grid {display: flex;gap: 20px;justify-content: center;flex-wrap: wrap;}.stat-card {flex: 1;min-width: 250px;max-width: 300px;background: rgba(255, 255, 255, 0.1);padding: 20px;border-radius: 8px;text-align: center;}.stat-value {font-size: 2em;font-weight: bold;color: white;margin: 10px 0;}.stat-label {color: white;font-size: 0.9em;}.gender-split {display: flex;justify-content: center;gap: 20px;margin-top: 10px;}.gender-stat {color: white;}@media screen and (max-width: 768px) {.controls {flex-direction: column;align-items: center;}select, input {width: 100%;}.tab-button {flex: 1 1 auto;text-align: center;padding: 8px;font-size: 14px;}.pie-chart-container {flex: 1 1 100%;}.chart-container {height: 300px;}h1 {font-size: 1.5rem;}h2 {font-size: 1.2rem;}.pie-chart-container, .time-periods-table {flex: 1 1 100%;}.top-stats-container {flex-direction: column;align-items: center;}.stats-box {width: 100%;}}@media screen and (max-width: 480px) {body {padding: 10px;}.container {padding: 10px;}.tab-button {font-size: 12px;padding: 6px;} .export-buttons {flex-direction: column;} .export-button {width: 100%;}} .export-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; padding: 10px; } .export-button { display: flex; align-items: center; gap: 8px; padding: 8px 16px; border: none; border-radius: 4px; background: #2f7622; color: white; cursor: pointer; font-weight: bold; transition: background-color 0.3s; } .export-button:hover { background: #245d1a; } .hourly-analysis-layout { display: flex; gap: 20px; margin-top: 20px; align-items: stretch; } .chart-container { flex: 3; min-width: 0; } .categories-selection { flex: 1; min-width: 200px; max-width: 300px; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); } .category-list { display: flex; flex-direction: column; gap: 10px; } .category-item { display: flex; align-items: center; gap: 8px; padding: 8px; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; } .category-item input[type="checkbox"] { margin: 0; width: 10%; min-width: 20px; } .category-item label { width: 90%; display: flex; align-items: center; gap: 8px; } .daily-summary { margin: 20px 0; width: 100%; } .daily-summary h3 { margin-bottom: 10px; color: #333; } .daily-summary-table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); } .daily-summary-table th, .daily-summary-table td { padding: 12px; text-align: center; border: 1px solid #ddd; } .daily-summary-table th { background: #f5f5f5; } .daily-dwell-time { margin-top: 20px; width: 100%; } .daily-dwell-time h3 { margin-bottom: 10px; color: #333; text-align: center;}.time-range-selector { margin-top: 0; text-align: left; } .time-range-selector input[type="range"] { width: 100%; margin: 10px 0; } .time-range-selector label { display: block; margin-top: 15px; } .fas, .fa-solid { color: #FFFFFF; background-color: #2f7622; padding: 8px; border-radius: 4px; }</style></head><body> <div class="top-banner"> <div class="stats-grid"> <div class="stat-card"> <div class="stat-label">Total Customers</div> <div class="stat-value" id="totalCustomers">-</div> </div> <div class="stat-card"> <div class="stat-label">Average Capture Rate</div> <div class="stat-value" id="avgCaptureRate">-</div> </div> <div class="stat-card"> <div class="stat-label">Gender Distribution</div> <div class="stat-value" id="genderDistribution"> <div class="gender-split"> <span class="gender-stat" id="menPercent">♂: -</span> <span class="gender-stat" id="womenPercent">♀: -</span> </div> </div> </div> </div> </div> <h1>Restaurant Analysis</h1> <div class="tab-container"> <div class="tab-buttons"> <button class="tab-button active" data-tab="daily">Daily Overview</button> <button class="tab-button" data-tab="hourly">Hourly Analysis</button> <button class="tab-button" data-tab="weekday">Weekday Analysis</button> </div> <div id="dailyTab" class="tab-content active"> <div class="container"> <h2>Daily Overview</h2> <div class="chart-container"> <div class="graph-controls"> <button class="download-button" onclick="downloadChartImage('trafficChart')"> <i class="fas fa-image"></i> </button> <button class="download-button" onclick="downloadChartData('trafficChart')"> <i class="fas fa-file-excel"></i> </button> </div> <canvas id="trafficChart"></canvas> </div> <div class="top-stats-container"> <div class="stats-box"> <h3>Top 3 Customer Days</h3> <ul id="topCustomersList"></ul> </div> <div class="stats-box"> <h3>Top 3 Capture Rate Days</h3> <ul id="topCaptureRateList"></ul> </div> </div> <div class="export-buttons"> <button class="export-button" onclick="exportToPDF('daily')"> <i class="fas fa-file-pdf export-icon"></i> PDF </button> <button class="export-button" onclick="exportToExcel('daily')"> <i class="fas fa-file-excel export-icon"></i> Excel </button> </div> </div> <div class="container"> <h2>Dwell Time Analysis</h2> <div class="chart-container"> <div class="graph-controls"> <button class="download-button" onclick="downloadChartImage('dwellTimeChart')"> <i class="fas fa-image"></i> </button> <button class="download-button" onclick="downloadChartData('dwellTimeChart')"> <i class="fas fa-file-excel"></i> </button> </div> <canvas id="dwellTimeChart"></canvas> </div> <div class="export-buttons"> <button class="export-button" onclick="exportToPDF('dwelltime')"> <i class="fas fa-file-pdf export-icon"></i> PDF </button> <button class="export-button" onclick="exportToExcel('dwelltime')"> <i class="fas fa-file-excel export-icon"></i> Excel </button> </div> </div> </div> <div id="hourlyTab" class="tab-content"> <div class="container"> <h2>Hourly Analysis</h2> <div class="date-selector"> <input type="text" id="datePicker" placeholder="Select Date"> <i class="fas fa-calendar calendar-icon"></i> </div> <div class="daily-summary"> <h3 id="dailySummaryTitle">Overall Data for -</h3> <table class="daily-summary-table"> <thead> <tr> <th>Total Visitors</th> <th>Capture Rate</th> <th>Gender Distribution</th> <th>Dwell Time</th> <th>Data Accuracy</th> </tr> </thead> <tbody> <tr> <td id="dailyVisitors">-</td> <td id="dailyCaptureRate">-</td> <td id="dailyGender">-</td> <td id="dailyDwellTime">-</td> <td id="dailyAccuracy">-</td> </tr> </tbody> </table> </div> </div> <div class="hourly-analysis-layout"> <div class="chart-container"> <div class="graph-controls"> <button class="download-button" onclick="downloadChartImage('hourlyChart')"> <i class="fas fa-image"></i> </button> <button class="download-button" onclick="downloadChartData('hourlyChart')"> <i class="fas fa-file-excel"></i> </button> </div> <canvas id="hourlyChart"></canvas> </div> <div class="categories-selection"> <h3>Categories</h3> <div class="category-list"> </div> </div> </div> <table style="width: 100%; border-collapse: collapse; margin-top: 20px;"> <tr> <td style="width: 60%; padding: 20px;"> <div class="chart-container"> <div class="graph-controls"> <button class="download-button" onclick="downloadChartImage('timeCapturePieChart')"> <i class="fas fa-image"></i> </button> <button class="download-button" onclick="downloadChartData('timeCapturePieChart')"> <i class="fas fa-file-excel"></i> </button> </div> <canvas id="timeCapturePieChart"></canvas> </div> </td> <td style="width: 40%; padding: 20px; vertical-align: top;"> <div class="time-range-selector"> <h3>Custom Time Range</h3> <label>Start Hour: <span id="startHourValue">7</span>:00</label> <input type="range" id="startHourRange" min="7" max="19" value="7"> <label>End Hour: <span id="endHourValue">20</span>:00</label> <input type="range" id="endHourRange" min="8" max="20" value="20"> </div> <div class="time-periods-legend"> <table class="time-periods-table"> <tr> <td><span class="color-indicator" style="background: rgba(47, 118, 34, 0.8)"></span>Morning (7:00-10:00)</td> <td id="morningRate">-</td> </tr> <tr> <td><span class="color-indicator" style="background: rgba(243, 151, 0, 0.8)"></span>Noon (12:00-14:00)</td> <td id="noonRate">-</td> </tr> <tr> <td><span class="color-indicator" style="background: #f39700"></span>Afternoon (16:00-20:00)</td> <td id="afternoonRate">-</td> </tr> <tr> <td><span class="color-indicator" style="background: #af9e50"></span>Custom Time Range</td> <td id="customRate">-</td> </tr> </table> </div> </td> </tr> </table> </div> <div class="export-buttons"> <button class="export-button" onclick="exportToPDF('hourly')"> <i class="fas fa-file-pdf export-icon"></i> </button> <button class="export-button" onclick="exportToExcel('hourly')"> <i class="fas fa-file-excel export-icon"></i> </button> </div> </div> <div id="weekdayTab" class="tab-content"> <div class="container"> <h2>Weekday Average Analysis</h2> <div class="controls"> <select id="weekdaySelect"> <option value="1" selected>Monday</option> <option value="2">Tuesday</option> <option value="3">Wednesday</option> <option value="4">Thursday</option> <option value="5">Friday</option> <option value="6">Saturday</option> <option value="0">Sunday</option> </select> </div> <div class="chart-container"> <div class="graph-controls"> <button class="download-button" onclick="downloadChartImage('weekdayChart')"> <i class="fas fa-image"></i> </button> <button class="download-button" onclick="downloadChartData('weekdayChart')"> <i class="fas fa-file-excel"></i> </button> </div> <canvas id="weekdayChart"></canvas> </div> <div class="export-buttons"> <button class="export-button" onclick="exportToPDF('weekday')"> <i class="fas fa-file-pdf export-icon"></i> </button> <button class="export-button" onclick="exportToExcel('weekday')"> <i class="fas fa-file-excel export-icon"></i> </button> </div> </div> </div> </div> <script>let rawData = [];let flatpickrInstance;let hourlyChart = null;let timeCaptureChart = null;Chart.register(ChartDataLabels);const columnMap = {'Customers': 1,'CustomersOUT': 2,'Men': 3,'MenOUT': 4,'Women': 5,'WomenOUT': 6,'Group': 7,'GroupOUT': 8,'Passersby': 9,'ACustomers': 10,'ACustomersOUT': 11,'CustomersLIVE': 12,'Dwelltime': 13};const categories = [ { id: 'Customers', label: 'Customers', color: 'rgba(47, 118, 34, 0.8)' }, { id: 'Passersby', label: 'Passersby', color: 'rgba(243, 151, 0, 0.8)' }, { id: 'Men', label: 'Men', color: 'rgba(0, 114, 178, 0.8)' }, { id: 'Women', label: 'Women', color: 'rgba(230, 159, 0, 0.8)' }, { id: 'Group', label: 'Groups', color: 'rgba(86, 180, 233, 0.8)' }, { id: 'CaptureRate', label: 'Capture Rate', color: 'rgba(0, 158, 115, 0.8)' }, { id: 'CustomersLIVE', label: 'Live Customers', color: 'rgba(213, 94, 0, 0.8)' } ];function getWeekNumber(date) {const target = new Date(date);target.setDate(target.getDate() + 4 - (target.getDay() || 7));const yearStart = new Date(target.getFullYear(), 0, 1);const weekNum = Math.ceil((((target - yearStart) / 86400000) + 1) / 7);return weekNum;}function getDateColor(dateStr) {if (!dateStr || typeof dateStr !== 'string') return '#000000';const parts = dateStr.split('/');if (parts.length !== 3) return '#000000';const [day, month, year] = parts;const date = new Date(year, month - 1, day);let dayOfWeek = date.getDay();dayOfWeek = dayOfWeek === 0 ? 7 : dayOfWeek;if (dayOfWeek === 6) return '#2f7622'; if (dayOfWeek === 7) return '#f39700'; return '#000000';}function initializeCategoryList() { const categoryList = document.querySelector('.category-list'); if (!categoryList) return; categoryList.innerHTML = categories.map(category => ` <div class="category-item"> <input type="checkbox" id="category-${category.id}" value="${category.id}" ${category.id === 'Customers' ? 'checked' : ''}> <label for="category-${category.id}"> <span style="color: ${category.color}">●</span> ${category.label} </label> </div> `).join(''); categoryList.querySelectorAll('input[type="checkbox"]').forEach(checkbox => { checkbox.addEventListener('change', () => { updateHourlyChart(); }); }); }function getSelectedCategories() { const checkboxes = document.querySelectorAll('.category-list input[type="checkbox"]:checked'); return Array.from(checkboxes).map(checkbox => { const categoryId = checkbox.value; const category = categories.find(c => c.id === categoryId); return category; }); }function isWithinOpeningHours(date, hour) {const dayOfWeek = date.getDay();const adjustedDay = dayOfWeek === 0 ? 7 : dayOfWeek;if (adjustedDay === 7) {return hour >= 8 && hour < 16;} else if (adjustedDay === 6) {return hour >= 8 && hour < 20;} else {return hour >= 7 && hour < 20;}}function calculateAverageData(rawData) {const averages = {};const counts = {};rawData.forEach(row => {const date = new Date(row[0]);const hour = date.getHours().toString().padStart(2, '0');const dayOfWeek = date.getDay();if (!averages[hour]) {averages[hour] = {value1: 0,value2: 0,count: 0,entering: 0,leaving: 0};}const customers = getValue('Customers', row);const customersOut = getValue('CustomersOUT', row);const passersby = getValue('Passersby', row);if (isWithinOpeningHours(date, hour)) {averages[hour].value1 += customers;averages[hour].value2 += passersby;averages[hour].entering += customers;averages[hour].leaving += customersOut;averages[hour].count++;}});let cumulativeEntering = 0;let cumulativeLeaving = 0;Object.keys(averages).sort().forEach(hour => {if (averages[hour].count > 0) {averages[hour].value1 = averages[hour].value1 / averages[hour].count;averages[hour].value2 = averages[hour].value2 / averages[hour].count;cumulativeEntering += averages[hour].entering / averages[hour].count;cumulativeLeaving += averages[hour].leaving / averages[hour].count;averages[hour].liveVisitors = Math.max(0, cumulativeEntering - cumulativeLeaving);}});return averages;}function calculateCaptureRate(customers, passersby) {if (passersby === 0) return 0;return (customers / passersby * 100).toFixed(1);}function getValue(column, row) {const customers = parseInt(row[columnMap['Customers']]) || 0;const passersby = parseInt(row[columnMap['Passersby']]) || 0;const menEntering = parseInt(row[columnMap['Men']]) || 0;const womenEntering = parseInt(row[columnMap['Women']]) || 0;const menLeaving = parseInt(row[columnMap['MenOUT']]) || 0;const womenLeaving = parseInt(row[columnMap['WomenOUT']]) || 0;const totalGender = menEntering + womenEntering;const adjustedMenEntering = totalGender > 0 ? customers * (menEntering / totalGender) : 0;const adjustedWomenEntering = totalGender > 0 ? customers * (womenEntering / totalGender) : 0;const totalGenderOut = menLeaving + womenLeaving;const adjustedMenLeaving = totalGenderOut > 0 ? customers * (menLeaving / totalGenderOut) : 0;const adjustedWomenLeaving = totalGenderOut > 0 ? customers * (womenLeaving / totalGenderOut) : 0;switch(column) {case 'Men': return adjustedMenEntering;case 'MenOUT': return adjustedMenLeaving;case 'Women': return adjustedWomenEntering;case 'WomenOUT': return adjustedWomenLeaving;case 'CaptureRate': return calculateCaptureRate(customers, passersby);case 'Customers': return customers;case 'CustomersOUT': return parseInt(row[columnMap['CustomersOUT']]) || 0;case 'Group': return parseInt(row[columnMap['Group']]) || 0;case 'GroupOUT': return parseInt(row[columnMap['GroupOUT']]) || 0;case 'Passersby': return passersby;case 'CustomersLIVE': return parseInt(row[columnMap['CustomersLIVE']]) || 0;case 'Dwelltime': return row[columnMap['Dwelltime']] || '0:00';default: return 0;}}async function loadInitialData() {try {console.log('Loading data from GitHub...');const response = await fetch('https://raw.githubusercontent.com/JFTHIBAUT/Xki/main/xdatax.csv');if (!response.ok) {throw new Error('Failed to fetch CSV from GitHub');}const csvData = await response.text();rawData = csvData.split('\n').filter(line => line.trim() !== '').map(line => line.split(';'));rawData.shift();updateTopBannerStats();createDailyChart();createDwellTimeChart();const availableDates = [...new Set(rawData.map(row => {const date = new Date(row[0]);return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;}))];if (availableDates.length > 0) {const firstDate = availableDates[0];if (flatpickrInstance) {flatpickrInstance.setDate(firstDate);updateHourlyChart();updateDailySummary(firstDate);updateTimeCaptureChart(firstDate);}}console.log('Data loaded from GitHub successfully!');} catch (error) {console.error('Error loading GitHub data:', error);}}function updateTopBannerStats() {let totalCustomers = 0;let totalPassersby = 0;let totalMen = 0;let totalWomen = 0;rawData.forEach(row => {const date = new Date(row[0]);if (isWithinOpeningHours(date, date.getHours())) {const customers = getValue('Customers', row);const passersby = getValue('Passersby', row);const men = getValue('Men', row);const women = getValue('Women', row);totalCustomers += customers;totalPassersby += passersby;totalMen += men;totalWomen += women;}});const avgCaptureRate = calculateCaptureRate(totalCustomers, totalPassersby);const totalGender = totalMen + totalWomen;const menPercent = totalGender > 0 ? (totalMen / totalGender * 100).toFixed(1) : 0;const womenPercent = totalGender > 0 ? (totalWomen / totalGender * 100).toFixed(1) : 0;document.getElementById('totalCustomers').textContent = totalCustomers.toLocaleString();document.getElementById('avgCaptureRate').textContent = avgCaptureRate + '%';document.getElementById('menPercent').textContent = `♂: ${menPercent}%`;document.getElementById('womenPercent').textContent = `♀: ${womenPercent}%`; }document.addEventListener('DOMContentLoaded', function() { const datePickerElement = document.getElementById('datePicker'); if (datePickerElement) { flatpickrInstance = flatpickr("#datePicker", { dateFormat: "d/m/Y", onChange: function(selectedDates) { if (selectedDates.length > 0) { const selectedDate = datePickerElement.value; updateHourlyChart(); updateDailySummary(selectedDate); updateTimeCaptureChart(selectedDate); } } }); } const startHourRange = document.getElementById('startHourRange'); const endHourRange = document.getElementById('endHourRange'); if (startHourRange) { startHourRange.addEventListener('input', function(e) { const startHourValue = document.getElementById('startHourValue'); if (startHourValue) { startHourValue.textContent = e.target.value; } const datePickerValue = document.getElementById('datePicker')?.value; if (datePickerValue) { updateTimeCaptureChart(datePickerValue); } }); } if (endHourRange) { endHourRange.addEventListener('input', function(e) { const endHourValue = document.getElementById('endHourValue'); if (endHourValue) { endHourValue.textContent = e.target.value; } const datePickerValue = document.getElementById('datePicker')?.value; if (datePickerValue) { updateTimeCaptureChart(datePickerValue); } }); } const weekdaySelect = document.getElementById('weekdaySelect'); if (weekdaySelect) { weekdaySelect.value = '1'; weekdaySelect.addEventListener('change', updateWeekdayChart); updateWeekdayChart(); } document.querySelectorAll('.tab-button').forEach(button => { button.addEventListener('click', () => { const tabId = button.getAttribute('data-tab') + 'Tab'; switchTab(tabId); }); }); loadInitialData(); initializeCategoryList();});function createDailyChart() {const trafficChartCanvas = document.getElementById('trafficChart');if (!trafficChartCanvas) return;const dailyData = {};rawData.forEach(row => {const date = new Date(row[0]);const hour = date.getHours();const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;if (isWithinOpeningHours(date, hour)) {const customers = parseInt(row[columnMap['Customers']]) || 0;const passersby = parseInt(row[columnMap['Passersby']]) || 0;const dwelltime = row[columnMap['Dwelltime']] || '0:00';if (!dailyData[datePart]) {dailyData[datePart] = {customers: 0,passersby: 0,dwelltime: dwelltime};}dailyData[datePart].customers += customers;dailyData[datePart].passersby += passersby;if (dwelltime !== '0:00') {dailyData[datePart].dwelltime = dwelltime;}}});const dates = Object.keys(dailyData).sort();const customerData = dates.map(date => dailyData[date].customers);const passersByData = dates.map(date => dailyData[date].passersby);const captureRateData = dates.map(date => calculateCaptureRate(dailyData[date].customers, dailyData[date].passersby));const ctx1 = trafficChartCanvas.getContext('2d');if (window.dailyChart) window.dailyChart.destroy();window.dailyChart = new Chart(ctx1, {data: {labels: dates,datasets: [{type: 'bar',label: 'Daily Customers',data: customerData,backgroundColor: 'rgba(47, 118, 34, 0.5)',borderColor: '#2f7622',yAxisID: 'y-customers',},{type: 'line',label: 'Daily Passersby',data: passersByData,borderColor: '#f39700',borderWidth: 2,fill: false,yAxisID: 'y-passersby',},{type: 'line',label: 'Capture Rate (%)',data: captureRateData,borderColor: '#c5d469',borderWidth: 2,fill: false,yAxisID: 'y-capture',}]},options: {responsive: true,maintainAspectRatio: false,plugins: {datalabels: {display: false},title: {display: true,text: 'Daily Traffic Overview',font: {size: 16}}},scales: {x: {ticks: {color: function(context) {if (!context || !context.tick || !context.tick.label) return '#000000';return getDateColor(context.tick.label);},callback: function(value, index, values) {const dateStr = dates[index]; if (!dateStr) return ''; return dateStr;},padding: 8,autoSkip: false},},'y-customers': {type: 'linear',position: 'left',title: {display: true,text: 'Customers'}},'y-passersby': {type: 'linear',position: 'right',title: {display: true,text: 'Passersby'}},'y-capture': {type: 'linear',position: 'right',title: {display: true,text: 'Capture Rate (%)'},min: 0,grid: {drawOnChartArea: false}}}}});const topCustomers = Object.entries(dailyData).map(([date, data]) => ({date, value: data.customers})).sort((a, b) => b.value - a.value).slice(0, 3);const topCaptureRates = Object.entries(dailyData).map(([date, data]) => ({date, value: calculateCaptureRate(data.customers, data.passersby)})).sort((a, b) => b.value - a.value).slice(0, 3);const topCustomersList = document.getElementById('topCustomersList');const topCaptureRateList = document.getElementById('topCaptureRateList');topCustomersList.innerHTML = topCustomers.map((item, index) => `<li><span>${index + 1}. ${item.date}</span><strong>${item.value.toLocaleString()} customers</strong></li>`).join('');topCaptureRateList.innerHTML = topCaptureRates.map((item, index) => `<li><span>${index + 1}. ${item.date}</span><strong>${parseFloat(item.value).toFixed(1)}%</strong></li>`).join('');const dwellTimeTableBody = document.getElementById('dwellTimeTableBody');if (dwellTimeTableBody) {const dailyDwellTimes = Object.entries(dailyData).map(([date, data]) => ({date, dwelltime: data.dwelltime})).sort((a, b) => { const [dayA, monthA, yearA] = a.date.split('/'); const [dayB, monthB, yearB] = b.date.split('/'); return new Date(yearA, monthA-1, dayA) - new Date(yearB, monthB-1, dayB); }); dwellTimeTableBody.innerHTML = dailyDwellTimes.map(item => `<tr><td>${item.date}</td><td>${item.dwelltime}</td></tr>`).join(''); } }function updateHourlyChart() {const hourlyChartCanvas = document.getElementById('hourlyChart');if (!hourlyChartCanvas) return;const selectedDate = document.getElementById('datePicker')?.value;const selectedCategories = getSelectedCategories();if (!selectedDate || rawData.length === 0 || selectedCategories.length === 0) return;const hourlyData = {};rawData.forEach(row => {const date = new Date(row[0]);const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;if (datePart === selectedDate) {const hour = date.getHours().toString().padStart(2, '0');if (!hourlyData[hour]) {hourlyData[hour] = {rawData: row};} selectedCategories.forEach(category => {hourlyData[hour][category.id] = getValue(category.id, row);});}});const hours = Object.keys(hourlyData).sort();const datasets = selectedCategories.map(category => {const dataset = {label: category.label,data: hours.map(hour => hourlyData[hour][category.id] || 0),backgroundColor: category.color,borderColor: category.color,borderWidth: 2};if (category.id === 'CaptureRate') {dataset.yAxisID = 'y-capture';} else if (category.id === 'Passersby') {dataset.yAxisID = 'y-passersby';} else {dataset.yAxisID = 'y-customers';}return dataset;});const ctx = hourlyChartCanvas.getContext('2d');if (hourlyChart instanceof Chart) {hourlyChart.destroy();}hourlyChart = new Chart(ctx, { type: 'line', data: { labels: hours.map(h => `${h}:00`), datasets: datasets }, options: { responsive: true, maintainAspectRatio: false, plugins: { datalabels: { display: false }, title: { display: true, text: 'Hourly Traffic Analysis', font: { size: 16 } } }, scales: { 'y-customers': { type: 'linear', position: 'left', title: { display: true, text: 'Customers' } }, 'y-passersby': { type: 'linear', position: 'right', title: { display: true, text: 'Passersby' } }, 'y-capture': { type: 'linear', position: 'right', title: { display: true, text: 'Capture Rate (%)' } } } } }); }function updateWeekdayChart() {const weekdayChartCanvas = document.getElementById('weekdayChart');if (!weekdayChartCanvas) return;const selectedDay = parseInt(document.getElementById('weekdaySelect')?.value || '1');const allHours = Array.from({length: 24}, (_, i) => i);const hourlyAverages = {};allHours.forEach(hour => {hourlyAverages[hour] = {customers: [],passersby: [],captureRates: []};});rawData.forEach(row => {const date = new Date(row[0]);if (date.getDay() === selectedDay) {const hour = date.getHours();const customers = getValue('Customers', row);const passersby = getValue('Passersby', row);const captureRate = calculateCaptureRate(customers, passersby);hourlyAverages[hour].customers.push(customers);hourlyAverages[hour].passersby.push(passersby);hourlyAverages[hour].captureRates.push(parseFloat(captureRate));}});const avgCustomers = allHours.map(hour => {const values = hourlyAverages[hour].customers;return values.length > 0 ? values.reduce((a,b) => a+b, 0) / values.length : 0;});const avgPassersby = allHours.map(hour => {const values = hourlyAverages[hour].passersby;return values.length > 0 ? values.reduce((a,b) => a+b, 0) / values.length : 0;});const avgCaptureRate = allHours.map(hour => {const values = hourlyAverages[hour].captureRates;return values.length > 0 ? values.reduce((a,b) => a+b, 0) / values.length : 0;});const ctx = weekdayChartCanvas.getContext('2d');if (window.weekdayChart instanceof Chart) {window.weekdayChart.destroy();} const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']; window.weekdayChart = new Chart(ctx, { data: { labels: allHours.map(h => `${h.toString().padStart(2, '0')}h00`), datasets: [{ type: 'bar', label: 'Average Customers', data: avgCustomers, backgroundColor: 'rgba(47, 118, 34, 0.5)', borderColor: '#2f7622', yAxisID: 'y-customers',},{ type: 'line', label: 'Average Passersby', data: avgPassersby, borderColor: '#f39700', borderWidth: 2, fill: false, yAxisID: 'y-passersby',},{ type: 'line', label: 'Average Capture Rate (%)', data: avgCaptureRate, borderColor: '#c5d469', borderWidth: 2, fill: false, yAxisID: 'y-capture',}]}, options: { responsive: true, maintainAspectRatio: false, plugins: { datalabels: { display: false }, title: { display: true, text: `Average Traffic for ${weekdays[selectedDay]}`, font: { size: 16 } } }, scales: { x: { grid: { display: true }, ticks: { autoSkip: false } }, 'y-customers': { type: 'linear', position: 'left', title: { display: true, text: 'Customers' } }, 'y-passersby': { type: 'linear', position: 'right', title: { display: true, text: 'Passersby' }, grid: { drawOnChartArea: false } }, 'y-capture': { type: 'linear', position: 'right', title: { display: true, text: 'Capture Rate (%)' }, grid: { drawOnChartArea: false } } } } });}function showMessage(message, type) {console.log(`${type}: ${message}`);const messageDiv = document.getElementById('message');if (messageDiv) {messageDiv.className = 'message ' + type;messageDiv.textContent = message;}}function switchTab(tabId) {const tabContent = document.getElementById(tabId);if (!tabContent) return;document.querySelectorAll('.tab-content').forEach(tab => {tab.classList.remove('active');});document.querySelectorAll('.tab-button').forEach(button => {button.classList.remove('active');});tabContent.classList.add('active');const activeButton = document.querySelector(`[data-tab="${tabId.replace('Tab', '')}"]`);if (activeButton) {activeButton.classList.add('active');}if (tabId === 'weekdayTab') {updateWeekdayChart();}window.dispatchEvent(new Event('resize'));}function updateTimeCaptureChart(selectedDate) {const startHourRange = document.getElementById('startHourRange');const endHourRange = document.getElementById('endHourRange');if (!startHourRange || !endHourRange || !selectedDate) return;const timeRanges = {morning: { start: 7, end: 10, label: 'Morning', color: 'rgba(47, 118, 34, 0.8)' }, noon: { start: 12, end: 14, label: 'Noon', color: 'rgba(243, 151, 0, 0.8)' }, afternoon: { start: 16, end: 20, label: 'Afternoon', color: '#f39700' }, custom: { start: parseInt(startHourRange.value), end: parseInt(endHourRange.value), label: 'Custom', color: '#af9e50' } }; const captureRates = {}; Object.entries(timeRanges).forEach(([period, range]) => { let totalCustomers = 0; let totalPassersby = 0; rawData.forEach(row => { const date = new Date(row[0]); const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`; const hour = date.getHours(); if (datePart === selectedDate && hour >= range.start && hour <= range.end && isWithinOpeningHours(date, hour)) { totalCustomers += getValue('Customers', row); totalPassersby += getValue('Passersby', row); } }); const captureRate = calculateCaptureRate(totalCustomers, totalPassersby); captureRates[period] = { rate: captureRate, label: `${range.label} (${range.start}:00-${range.end}:00): ${captureRate}%`, color: range.color }; const rateElement = document.getElementById(`${period}Rate`); if (rateElement) { rateElement.textContent = `${captureRate}%`; } }); const ctx = document.getElementById('timeCapturePieChart').getContext('2d'); if (timeCaptureChart instanceof Chart) { timeCaptureChart.destroy(); } timeCaptureChart = new Chart(ctx, { type: 'pie', data: { labels: Object.values(captureRates).map(cr => cr.label), datasets: [{ data: Object.values(captureRates).map(cr => cr.rate), backgroundColor: Object.values(captureRates).map(cr => cr.color), borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false }, datalabels: { color: '#fff', font: { weight: 'bold', size: 14 }, formatter: (value) => { if (!value || isNaN(value)) return '0%'; return parseFloat(value).toFixed(1) + '%'; }, anchor: 'center', align: 'center' }, title: { display: true, text: 'Time Period Capture Rate Analysis', font: { size: 16 } } } } }); } function downloadChartImage(chartId) { const canvas = document.getElementById(chartId); const link = document.createElement('a'); link.download = `${chartId}.png`; link.href = canvas.toDataURL('image/png'); link.click(); } function downloadChartData(chartId) { const chart = Chart.getChart(chartId); if (!chart) return; const data = chart.data; const ws = XLSX.utils.aoa_to_sheet([ ['Hour', ...data.datasets.map(ds => ds.label)], ...data.labels.map((label, i) => [ label, ...data.datasets.map(ds => ds.data[i]) ]) ]); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Chart Data'); XLSX.writeFile(wb, `${chartId}_data.xlsx`); } function updateDailySummary(selectedDate) { if (!selectedDate) return; const dailyData = { visitors: 0, passersby: 0, menCount: 0, womenCount: 0, customersOut: 0}; rawData.forEach(row => { const date = new Date(row[0]); const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`; if (datePart === selectedDate) { dailyData.visitors += getValue('Customers', row); dailyData.passersby += getValue('Passersby', row); dailyData.menCount += getValue('Men', row); dailyData.womenCount += getValue('Women', row); dailyData.customersOut += getValue('CustomersOUT', row); } }); const dwellTime = rawData.find(row => { const date = new Date(row[0]); const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`; return datePart === selectedDate; })?.[columnMap['Dwelltime']] || '0:00'; const [day, month, year] = selectedDate.split('/'); const dateObj = new Date(year, month - 1, day); const formattedDate = dateObj.toLocaleDateString('en-US', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' }); const captureRate = calculateCaptureRate(dailyData.visitors, dailyData.passersby); const totalGender = dailyData.menCount + dailyData.womenCount; const genderDist = totalGender > 0 ? `♂ ${((dailyData.menCount/totalGender)*100).toFixed(1)}% | ♀ ${((dailyData.womenCount/totalGender)*100).toFixed(1)}%` : '-'; let accuracy; if (dailyData.visitors > 0 && dailyData.customersOut > 0) { const ratio = dailyData.visitors / dailyData.customersOut; accuracy = ratio > 1 ? ((dailyData.customersOut / dailyData.visitors) * 100).toFixed(1) : ((dailyData.visitors / dailyData.customersOut) * 100).toFixed(1); } else { accuracy = '-'; } let formattedDwellTime = dwellTime; document.getElementById('dailySummaryTitle').textContent = `Overall Data for ${formattedDate}`; document.getElementById('dailyVisitors').textContent = dailyData.visitors.toLocaleString(); document.getElementById('dailyCaptureRate').textContent = `${captureRate}%`; document.getElementById('dailyGender').textContent = genderDist; document.getElementById('dailyDwellTime').textContent = formattedDwellTime; document.getElementById('dailyAccuracy').textContent = accuracy === '-' ? '-' : `${accuracy}%`; }function createDwellTimeChart() { const dwellTimeChartCanvas = document.getElementById('dwellTimeChart'); if (!dwellTimeChartCanvas) return; const dailyData = {}; rawData.forEach(row => { const date = new Date(row[0]); const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`; const hour = date.getHours(); if (isWithinOpeningHours(date, hour)) { const dwelltime = row[columnMap['Dwelltime']] || '0:00'; if (!dailyData[datePart]) { dailyData[datePart] = dwelltime; } } }); const dates = Object.keys(dailyData).sort((a, b) => { const [dayA, monthA, yearA] = a.split('/'); const [dayB, monthB, yearB] = b.split('/'); return new Date(yearA, monthA-1, dayA) - new Date(yearB, monthB-1, dayB); }); const dwellTimeData = dates.map(date => { const [minutes, seconds] = dailyData[date].split(':').map(Number); return minutes + (seconds / 60); }); const ctx = dwellTimeChartCanvas.getContext('2d'); if (window.dwellTimeChart instanceof Chart) { window.dwellTimeChart.destroy(); } window.dwellTimeChart = new Chart(ctx, { type: 'line', data: { labels: dates, datasets: [{ label: 'Average Dwell Time (minutes)', data: dwellTimeData, borderColor: '#2f7622', backgroundColor: 'rgba(47, 118, 34, 0.1)', borderWidth: 2, fill: true, tension: 0.4 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { datalabels: { display: false }, title: { display: true, text: 'Average Dwell Time', font: { size: 16 } } }, scales: { x: { ticks: { maxRotation: 45, minRotation: 45, color: function(context) { if (!context || !context.tick || !context.tick.label) return '#000000'; return getDateColor(context.tick.label); } } }, y: { title: { display: true, text: 'Minutes' }, min: 0 } } } }); } </script></body></html>