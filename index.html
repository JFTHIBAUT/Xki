<html><head><base href="." /><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Restaurant Analysis</title><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script><script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"><script src="https://cdn.jsdelivr.net/npm/flatpickr"></script><style>body {font-family: Arial, sans-serif;margin: 0;padding: 15px;background-color: #f5f5f5;}.container {background: white;padding: 15px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);margin-bottom: 20px;width: 100%;box-sizing: border-box;}.chart-container {height: 400px;margin: 20px 0;width: 100%;position: relative;}.pie-charts-container {display: flex;flex-wrap: wrap;gap: 20px;margin-top: 20px;justify-content: space-between;}.pie-chart-container {flex: 1 1 calc(33.333% - 20px);min-width: 250px;height: 300px;position: relative;}h1, h2 {color: #333;text-align: center;font-size: clamp(1.5rem, 4vw, 2.5rem);}.controls {display: flex;gap: 10px;margin: 20px 0;justify-content: center;flex-wrap: wrap;}select, input {padding: 8px;border-radius: 4px;border: 1px solid #ddd;max-width: 100%;min-width: 200px;}.date-selector {text-align: center;margin: 20px 0;}#datePicker {padding: 8px;border-radius: 4px;border: 1px solid #ddd;width: 100%;max-width: 200px;text-align: center;}.tab-container {width: 100%;margin-top: 20px;}.tab-buttons {display: flex;gap: 10px;margin-bottom: 20px;flex-wrap: wrap;justify-content: center;}.tab-button {padding: 10px 20px;background: #f5f5f5;border: 2px solid #2f7622;border-radius: 4px;cursor: pointer;color: #2f7622;font-weight: bold;white-space: nowrap;}.tab-button.active {background: #2f7622;color: white;}.tab-content {display: none;}.tab-content.active {display: block;}.checkbox-label {display: flex;align-items: center;gap: 5px;cursor: pointer;white-space: nowrap;}#column2 {transition: opacity 0.3s;}#column2.hidden {display: none;}.time-range-selector {margin-top: 10px;text-align: center;width: 100%;}.time-range-selector input[type="range"] {width: 100%;max-width: 120px;}.time-periods-legend {text-align: center;margin: 10px 0;font-size: 0.9em;}.time-periods-table {flex: 1 1 calc(33.333% - 20px);min-width: 250px;margin-top: 0;border-collapse: collapse;}.time-periods-table th,.time-periods-table td {padding: 8px;border: 1px solid #ddd;text-align: left;vertical-align: middle;}.time-periods-table th {background-color: #f5f5f5;}.color-indicator {width: 20px;height: 20px;border-radius: 50%;display: inline-block;margin-right: 10px;vertical-align: middle;}.top-stats-container {display: flex;gap: 20px;margin-top: 20px;justify-content: center;}.stats-box {background: rgba(255, 255, 255, 0.1);padding: 20px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);flex: 1;min-width: 250px;max-width: 300px;}.stats-box h3 {color: #ffffff;margin-top: 0;font-size: 1.1rem;text-align: center;margin-bottom: 15px;}.stats-box ul {list-style: none;padding: 0;margin: 0;}.stats-box li {padding: 10px;margin-bottom: 8px;background: #f5f5f5;border-radius: 4px;display: flex;justify-content: space-between;align-items: center;}.stats-box li:last-child {margin-bottom: 0;}.time-periods-table th,.time-periods-table td {padding: 8px;border: 1px solid #ddd;text-align: left;vertical-align: middle;}.time-periods-table th {background-color: #f5f5f5;}.top-banner {background: #2f7622;padding: 20px;margin-bottom: 20px;border-radius: 8px;box-shadow: 0 2px 4px rgba(0,0,0,0.1);color: white;}.stats-grid {display: flex;gap: 20px;justify-content: center;flex-wrap: wrap;}.stat-card {flex: 1;min-width: 250px;max-width: 300px;background: rgba(255, 255, 255, 0.1);padding: 20px;border-radius: 8px;text-align: center;}.stat-value {font-size: 2em;font-weight: bold;color: white;margin: 10px 0;}.stat-label {color: white;font-size: 0.9em;}.gender-split {display: flex;justify-content: center;gap: 20px;margin-top: 10px;}.gender-stat {color: white;}@media screen and (max-width: 768px) {.controls {flex-direction: column;align-items: center;}select, input {width: 100%;}.tab-button {flex: 1 1 auto;text-align: center;padding: 8px;font-size: 14px;}.pie-chart-container {flex: 1 1 100%;}.chart-container {height: 300px;}h1 {font-size: 1.5rem;}h2 {font-size: 1.2rem;}.pie-chart-container, .time-periods-table {flex: 1 1 100%;}.top-stats-container {flex-direction: column;align-items: center;}.stats-box {width: 100%;}}@media screen and (max-width: 480px) {body {padding: 10px;}.container {padding: 10px;}.tab-button {font-size: 12px;padding: 6px;}</style></head><body> <div class="top-banner"> <div class="stats-grid"> <div class="stat-card"> <div class="stat-label">Total Customers</div> <div class="stat-value" id="totalCustomers">-</div> </div> <div class="stat-card"> <div class="stat-label">Average Capture Rate</div> <div class="stat-value" id="avgCaptureRate">-</div> </div> <div class="stat-card"> <div class="stat-label">Gender Distribution</div> <div class="stat-value" id="genderDistribution"> <div class="gender-split"> <span class="gender-stat" id="menPercent">-</span> <span class="gender-stat" id="womenPercent">-</span> </div> </div> </div> </div> </div> <h1>Restaurant Analysis</h1> <div class="tab-container"> <div class="tab-buttons"> <button class="tab-button active" data-tab="daily">Daily Overview</button> <button class="tab-button" data-tab="hourly">Hourly Analysis</button> <button class="tab-button" data-tab="weekday">Weekday Analysis</button> </div> <div id="dailyTab" class="tab-content active"> <div class="container"> <h2>Daily Overview</h2> <div class="chart-container"> <canvas id="trafficChart"></canvas> </div> <div class="top-stats-container"> <div class="stats-box"> <h3>Top 3 Customer Days</h3> <ul id="topCustomersList"></ul> </div> <div class="stats-box"> <h3>Top 3 Capture Rate Days</h3> <ul id="topCaptureRateList"></ul> </div> </div> </div> </div> <div id="hourlyTab" class="tab-content"> <div class="container"> <h2>Hourly Analysis</h2> <div class="date-selector"> <input type="text" id="datePicker" placeholder="Select Date"> </div> <div class="controls"> <select id="column1"> <option value="Customers">Customers Entering</option> <option value="CustomersOUT">Customers Leaving</option> <option value="Men">Men Entering</option> <option value="MenOUT">Men Leaving</option> <option value="Women">Women Entering</option> <option value="WomenOUT">Women Leaving</option> <option value="Group">Group Entering</option> <option value="GroupOUT">Group Leaving</option> <option value="Passersby">Passersby</option> <option value="CaptureRate">Capture Rate (%)</option> <option value="LiveVisitors">Live Visitors</option> </select> <label class="checkbox-label"> <input type="checkbox" id="showSecondCategory"> Benchmark </label> <select id="column2"> <option value="Passersby">Passersby</option> <option value="Customers">Customers Entering</option> <option value="CustomersOUT">Customers Leaving</option> <option value="Men">Men Entering</option> <option value="MenOUT">Men Leaving</option> <option value="Women">Women Entering</option> <option value="WomenOUT">Women Leaving</option> <option value="Group">Group Entering</option> <option value="GroupOUT">Group Leaving</option> <option value="CaptureRate">Capture Rate (%)</option> <option value="LiveVisitors">Live Visitors</option> </select> </div> <div class="chart-container"> <canvas id="hourlyChart"></canvas> </div> <div class="pie-charts-container"> <div class="pie-chart-container"> <canvas id="genderPieChart"></canvas> </div> <div class="pie-chart-container"> <canvas id="timeCapturePieChart"></canvas> </div> <table class="time-periods-table"> <thead> <tr> <th>Period</th> <th>Time Range</th> <th>Capture Rate</th> </tr> </thead> <tbody> <tr> <td><span class="color-indicator" style="background: rgba(47, 118, 34, 0.8)"></span>Morning</td> <td>7:00 - 10:00</td> <td id="morningRate">-</td> </tr> <tr> <td><span class="color-indicator" style="background: rgba(243, 151, 0, 0.8)"></span>Noon</td> <td>12:00 - 14:00</td> <td id="noonRate">-</td> </tr> <tr> <td><span class="color-indicator" style="background: #f39700"></span>Afternoon</td> <td>16:00 - 20:00</td> <td id="afternoonRate">-</td> </tr> <tr> <td><span class="color-indicator" style="background: #af9e50"></span>Custom</td> <td class="time-range-cell"> <div class="time-range-inputs"> <input type="range" id="startHourRange" min="0" max="23" value="11"> <input type="range" id="endHourRange" min="0" max="23" value="15"> </div> <span id="customTimeRange">11:00 - 15:00</span> </td> <td id="customRate">-</td> </tr> </tbody> </table> <div class="time-range-selector"> </div> </div> </div> </div> <div id="weekdayTab" class="tab-content"> <div class="container"> <h2>Weekday Average Analysis</h2> <div class="controls"> <select id="weekdaySelect"> <option value="1">Monday</option> <option value="2">Tuesday</option> <option value="3">Wednesday</option> <option value="4">Thursday</option> <option value="5">Friday</option> <option value="6">Saturday</option> <option value="0">Sunday</option> </select> </div> <div class="chart-container"> <canvas id="weekdayChart"></canvas> </div> </div> </div> </div> <script>let rawData = [];let flatpickrInstance;let hourlyChart = null;let genderPieChart = null;let timeCaptureChart = null;Chart.register(ChartDataLabels);function isWithinOpeningHours(date, hour) {const dayOfWeek = date.getDay();if (dayOfWeek === 0) {return hour >= 8 && hour < 16;} else if (dayOfWeek === 6) {return hour >= 8 && hour < 20;} else {return hour >= 7 && hour < 20;}}function calculateAverageData(rawData) {const averages = {};const counts = {};rawData.forEach(row => {const date = new Date(row[0]);const hour = date.getHours().toString().padStart(2, '0');const dayOfWeek = date.getDay();if (!averages[hour]) {averages[hour] = {value1: 0,value2: 0,count: 0,entering: 0,leaving: 0};}const customers = getValue('Customers', row);const customersOut = getValue('CustomersOUT', row);const passersby = getValue('Passersby', row);if (isWithinOpeningHours(date, hour)) {averages[hour].value1 += customers;averages[hour].value2 += passersby;averages[hour].entering += customers;averages[hour].leaving += customersOut;averages[hour].count++;}});let cumulativeEntering = 0;let cumulativeLeaving = 0;Object.keys(averages).sort().forEach(hour => {if (averages[hour].count > 0) {averages[hour].value1 = averages[hour].value1 / averages[hour].count;averages[hour].value2 = averages[hour].value2 / averages[hour].count;cumulativeEntering += averages[hour].entering / averages[hour].count;cumulativeLeaving += averages[hour].leaving / averages[hour].count;averages[hour].liveVisitors = Math.max(0, cumulativeEntering - cumulativeLeaving);}});return averages;}const columnMap = {'Customers': 1,'CustomersOUT': 2,'Men': 3,'MenOUT': 4,'Women': 5,'WomenOUT': 6,'Group': 7,'GroupOUT': 8,'Passersby': 9};function calculateCaptureRate(customers, passersby) {if (passersby === 0) return 0;return (customers / passersby * 100).toFixed(1);}function getDateColor(dateStr) {if (!dateStr || typeof dateStr !== 'string') return '#000000';const parts = dateStr.split('/');if (parts.length !== 3) return '#000000';const [day, month, year] = parts;const date = new Date(year, month - 1, day);let dayOfWeek = date.getDay() || 7;if (dayOfWeek === 6) return '#2f7622';if (dayOfWeek === 7) return '#f39700';return '#000000';}function getWeekNumber(date) {const target = new Date(date);target.setDate(target.getDate() + 4 - (target.getDay() || 7));const yearStart = new Date(target.getFullYear(), 0, 1);const weekNum = Math.ceil((((target - yearStart) / 86400000) + 1) / 7);return weekNum;}function getValue(column, row) {const customers = parseInt(row[columnMap['Customers']]) || 0;const passersby = parseInt(row[columnMap['Passersby']]) || 0;const menEntering = parseInt(row[columnMap['Men']]) || 0;const womenEntering = parseInt(row[columnMap['Women']]) || 0;const menLeaving = parseInt(row[columnMap['MenOUT']]) || 0;const womenLeaving = parseInt(row[columnMap['WomenOUT']]) || 0;const totalGender = menEntering + womenEntering;const adjustedMenEntering = totalGender > 0 ? customers * (menEntering / totalGender) : 0;const adjustedWomenEntering = totalGender > 0 ? customers * (womenEntering / totalGender) : 0;const totalGenderOut = menLeaving + womenLeaving;const adjustedMenLeaving = totalGenderOut > 0 ? customers * (menLeaving / totalGenderOut) : 0;const adjustedWomenLeaving = totalGenderOut > 0 ? customers * (womenLeaving / totalGenderOut) : 0;switch(column) {case 'Men': return adjustedMenEntering;case 'MenOUT': return adjustedMenLeaving;case 'Women': return adjustedWomenEntering;case 'WomenOUT': return adjustedWomenLeaving;case 'CaptureRate': return calculateCaptureRate(customers, passersby);case 'Customers': return customers;case 'CustomersOUT': return parseInt(row[columnMap['CustomersOUT']]) || 0;case 'Group': return parseInt(row[columnMap['Group']]) || 0;case 'GroupOUT': return parseInt(row[columnMap['GroupOUT']]) || 0;case 'Passersby': return passersby;case 'LiveVisitors': return 0;default: return 0;}}async function loadInitialData() {try {console.log('Loading data from GitHub...');const response = await fetch('https://raw.githubusercontent.com/JFTHIBAUT/Ex/main/xxdata.csv');if (!response.ok) {throw new Error('Failed to fetch CSV from GitHub');}const csvData = await response.text();rawData = csvData.split('\n').filter(line => line.trim() !== '').map(line => line.split(';'));rawData.shift();updateTopBannerStats();createDailyChart();const availableDates = [...new Set(rawData.map(row => {const date = new Date(row[0]);return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;}))];if (availableDates.length > 0) {const firstDate = availableDates[0];if (flatpickrInstance) {flatpickrInstance.setDate(firstDate);updateHourlyChart();}}updateWeekdayChart();console.log('Data loaded from GitHub successfully!');} catch (error) {console.error('Error loading GitHub data:', error);}}function updateTopBannerStats() {let totalCustomers = 0;let totalPassersby = 0;let totalMen = 0;let totalWomen = 0;rawData.forEach(row => {const date = new Date(row[0]);const hour = date.getHours();if (isWithinOpeningHours(date, hour)) {const customers = getValue('Customers', row);const passersby = getValue('Passersby', row);const men = getValue('Men', row);const women = getValue('Women', row);totalCustomers += customers;totalPassersby += passersby;totalMen += men;totalWomen += women;}});const avgCaptureRate = calculateCaptureRate(totalCustomers, totalPassersby);const totalGender = totalMen + totalWomen;const menPercent = totalGender > 0 ? (totalMen / totalGender * 100).toFixed(1) : 0;const womenPercent = totalGender > 0 ? (totalWomen / totalGender * 100).toFixed(1) : 0;document.getElementById('totalCustomers').textContent = totalCustomers.toLocaleString();document.getElementById('avgCaptureRate').textContent = avgCaptureRate + '%';document.getElementById('menPercent').textContent = `Men: ${menPercent}%`;document.getElementById('womenPercent').textContent = `Women: ${womenPercent}%`; }document.addEventListener('DOMContentLoaded', function() {flatpickrInstance = flatpickr("#datePicker", {dateFormat: "d/m/Y",onChange: function(selectedDates) {if (selectedDates.length > 0) {updateHourlyChart();}}});document.getElementById('column1').addEventListener('change', updateHourlyChart);document.getElementById('column2').addEventListener('change', updateHourlyChart);document.getElementById('weekdaySelect').addEventListener('change', updateWeekdayChart);document.getElementById('showSecondCategory').addEventListener('change', function(e) {const column2Select = document.getElementById('column2');column2Select.classList.toggle('hidden', !e.target.checked);updateHourlyChart();});document.getElementById('startHourRange').addEventListener('input', function() {const startHour = parseInt(this.value);const endHour = parseInt(document.getElementById('endHourRange').value);if (startHour >= endHour) {document.getElementById('endHourRange').value = startHour + 1;}document.getElementById('customTimeRange').textContent = `${startHour}:00 - ${document.getElementById('endHourRange').value}:00`;updateTimeCaptureChart(document.getElementById('datePicker').value);});document.getElementById('endHourRange').addEventListener('input', function() {const endHour = parseInt(this.value);const startHour = parseInt(document.getElementById('startHourRange').value);if (endHour <= startHour) {document.getElementById('startHourRange').value = endHour - 1;}document.getElementById('customTimeRange').textContent = `${document.getElementById('startHourRange').value}:00 - ${endHour}:00`;updateTimeCaptureChart(document.getElementById('datePicker').value);});loadInitialData();document.querySelectorAll('.tab-button').forEach(button => {button.addEventListener('click', () => {const tabId = button.getAttribute('data-tab') + 'Tab';switchTab(tabId);});});});function createDailyChart() {const dailyData = {};rawData.forEach(row => {const date = new Date(row[0]);const hour = date.getHours();const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;if (isWithinOpeningHours(date, hour)) {const customers = parseInt(row[columnMap['Customers']]) || 0;const passersby = parseInt(row[columnMap['Passersby']]) || 0;if (!dailyData[datePart]) {dailyData[datePart] = {customers: 0,passersby: 0};}dailyData[datePart].customers += customers;dailyData[datePart].passersby += passersby;}});const dates = Object.keys(dailyData).sort();const customerData = dates.map(date => dailyData[date].customers);const passersByData = dates.map(date => dailyData[date].passersby);const captureRateData = dates.map(date => calculateCaptureRate(dailyData[date].customers, dailyData[date].passersby));const ctx1 = document.getElementById('trafficChart').getContext('2d');if (window.dailyChart) window.dailyChart.destroy();window.dailyChart = new Chart(ctx1, {data: {labels: dates,datasets: [{type: 'bar',label: 'Daily Customers',data: customerData,backgroundColor: 'rgba(47, 118, 34, 0.5)',borderColor: '#2f7622',yAxisID: 'y-customers',},{type: 'line',label: 'Daily Passersby',data: passersByData,borderColor: '#f39700',borderWidth: 2,fill: false,yAxisID: 'y-passersby',},{type: 'line',label: 'Capture Rate (%)',data: captureRateData,borderColor: '#c5d469',borderWidth: 2,fill: false,yAxisID: 'y-capture',}]},options: {responsive: true,maintainAspectRatio: false,plugins: {datalabels: {display: false}},scales: {x: {ticks: {color: function(context) {return getDateColor(context.tick.label);},callback: function(value, index, ticks) {const dateStr = this.getLabelForValue(value);if (!dateStr) return '';const [day, month, year] = dateStr.split('/');const date = new Date(year, month - 1, day);const weekNum = getWeekNumber(date);const prevDateStr = index > 0 ? this.getLabelForValue(ticks[index - 1].value) : null;const prevWeekNum = prevDateStr ? getWeekNumber(new Date(prevDateStr.split('/')[2], prevDateStr.split('/')[1] - 1, prevDateStr.split('/')[0])) : null;return [weekNum !== prevWeekNum ? `Week ${weekNum}` : '', dateStr];},padding: 8,autoSkip: false},},'y-customers': {type: 'linear',position: 'left',title: {display: true,text: 'Customers'}},'y-passersby': {type: 'linear',position: 'right',title: {display: true,text: 'Passersby'}},'y-capture': {type: 'linear',position: 'right',title: {display: true,text: 'Capture Rate (%)'},min: 0,grid: {drawOnChartArea: false}}}}});const topCustomers = Object.entries(dailyData).map(([date, data]) => ({date, value: data.customers})).sort((a, b) => b.value - a.value).slice(0, 3);const topCaptureRates = Object.entries(dailyData).map(([date, data]) => ({date, value: calculateCaptureRate(data.customers, data.passersby)})).sort((a, b) => b.value - a.value).slice(0, 3);const topCustomersList = document.getElementById('topCustomersList');const topCaptureRateList = document.getElementById('topCaptureRateList');topCustomersList.innerHTML = topCustomers.map((item, index) => `<li><span>${index + 1}. ${item.date}</span><strong>${item.value.toLocaleString()} customers</strong></li>`).join('');topCaptureRateList.innerHTML = topCaptureRates.map((item, index) => `<li><span>${index + 1}. ${item.date}</span><strong>${parseFloat(item.value).toFixed(1)}%</strong></li>`).join('');}function updateGenderPieChart(selectedDate) {const [day, month, year] = selectedDate.split('/');const dailyGenderData = {men: 0,women: 0};rawData.forEach(row => {const date = new Date(row[0]);const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;if (datePart === selectedDate) {dailyGenderData.men += getValue('Men', row);dailyGenderData.women += getValue('Women', row);}});const total = dailyGenderData.men + dailyGenderData.women;const menPercent = total > 0 ? (dailyGenderData.men / total * 100).toFixed(1) : 0;const womenPercent = total > 0 ? (dailyGenderData.women / total * 100).toFixed(1) : 0;const ctx = document.getElementById('genderPieChart').getContext('2d');if (genderPieChart instanceof Chart) {genderPieChart.destroy();}genderPieChart = new Chart(ctx, {type: 'pie',data: {labels: [`Men (${menPercent}%)`, `Women (${womenPercent}%)`],datasets: [{data: [dailyGenderData.men, dailyGenderData.women],backgroundColor: ['rgba(47, 118, 34, 0.8)','rgba(243, 151, 0, 0.8)'],borderColor: ['#2f7622','#f39700'],borderWidth: 1}]},options: {responsive: true,maintainAspectRatio: false,plugins: {datalabels: {color: '#fff',font: {weight: 'bold',size: 14},formatter: function(value, context) {if (!value || isNaN(value)) return '0%';const total = context.dataset.data.reduce((sum, val) => sum + (val || 0), 0);const percentage = total > 0 ? (value / total * 100) : 0;return percentage.toFixed(1) + '%';}},title: {display: true,text: 'Gender Distribution'},legend: {position: 'bottom'}}}});}function updateHourlyChart() {const selectedDate = document.getElementById('datePicker').value;const column1 = document.getElementById('column1').value;const column2 = document.getElementById('column2').value;const showSecondCategory = document.getElementById('showSecondCategory').checked;if (!selectedDate || rawData.length === 0) return;const averageData = calculateAverageData(rawData);const [day, month, year] = selectedDate.split('/');const selectedDateObj = new Date(year, month - 1, day);const selectedDayOfWeek = selectedDateObj.getDay();let cumulativeEntering = 0;let cumulativeLeaving = 0;const hourlyData = {};rawData.forEach(row => {const date = new Date(row[0]);const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;if (datePart === selectedDate) {const hour = date.getHours().toString().padStart(2, '0');if (!hourlyData[hour]) {hourlyData[hour] = {value1: getValue(column1, row),value2: getValue(column2, row),rawData: row};} else {hourlyData[hour].value1 += getValue(column1, row);hourlyData[hour].value2 += getValue(column2, row);} cumulativeEntering += getValue('Customers', row);cumulativeLeaving += getValue('CustomersOUT', row);}});const calculateLiveVisitors = (data, targetHour) => {let entering = 0;let leaving = 0;Object.keys(data).forEach(hour => {if (parseInt(hour) <= parseInt(targetHour)) {entering += getValue('Customers', data[hour].rawData) || 0;leaving += getValue('CustomersOUT', data[hour].rawData) || 0;}});return Math.max(0, entering - leaving);};const hours = Object.keys(hourlyData).sort();const values1 = hours.map(hour => column1 === 'LiveVisitors' ? averageData[hour]?.liveVisitors || 0 : hourlyData[hour].value1);const values2 = hours.map(hour => column2 === 'LiveVisitors' ? averageData[hour]?.liveVisitors || 0 : hourlyData[hour].value2);const avgValues1 = hours.map(hour => {if (column1 === 'LiveVisitors') {return averageData[hour]?.liveVisitors || 0;}return averageData[hour]?.value1 || 0;});const avgValues2 = hours.map(hour => {if (column2 === 'LiveVisitors') {return averageData[hour]?.liveVisitors || 0;}return averageData[hour]?.value2 || 0;});const ctx = document.getElementById('hourlyChart').getContext('2d');if (hourlyChart instanceof Chart) {hourlyChart.destroy();}const needsDualAxes = column1 === 'Passersby' || column2 === 'Passersby' || column1 === 'CaptureRate' || column2 === 'CaptureRate';const chartConfig = {type: 'line',data: {labels: hours.map(h => `${h}:00`),datasets: [{type: 'bar',label: `Average ${column1}`,data: avgValues1,backgroundColor: `rgba(47, 118, 34, 0.5)`,borderColor: '#2f7622',yAxisID: needsDualAxes && showSecondCategory ? 'y1' : 'y'},{type: 'line',label: column1,data: values1,borderColor: '#2f7622',backgroundColor: 'rgba(47, 118, 34, 0.2)',yAxisID: needsDualAxes && showSecondCategory ? 'y1' : 'y'}]} ,options: {responsive: true,maintainAspectRatio: false,plugins: {datalabels: {display: false}},scales: {y: {type: 'linear',position: 'left',title: {display: true,text: 'Count'}}}}};if (showSecondCategory) {chartConfig.data.datasets.push({type: 'bar',label: `Average ${column2}`,data: avgValues2,backgroundColor: `rgba(243, 151, 0, 0.5)`,borderColor: '#f39700',yAxisID: needsDualAxes ? 'y2' : 'y'}, {type: 'line',label: column2,data: values2,borderColor: '#f39700',backgroundColor: 'rgba(243, 151, 0, 0.2)',yAxisID: needsDualAxes ? 'y2' : 'y'});if (needsDualAxes) {chartConfig.options.scales = {y1: {type: 'linear',position: 'left',title: {display: true,text: column1},min: column1 === 'CaptureRate' ? 0 : undefined},y2: {type: 'linear',position: 'right',title: {display: true,text: column2},min: column2 === 'CaptureRate' ? 0 : undefined,grid: {drawOnChartArea: false}}};}}hourlyChart = new Chart(ctx, chartConfig);updateGenderPieChart(selectedDate);updateTimeCaptureChart(selectedDate);}function updateWeekdayChart() {const selectedDay = parseInt(document.getElementById('weekdaySelect').value);const hourlyAverages = {};rawData.forEach(row => {const date = new Date(row[0]);if (date.getDay() === selectedDay) {const hour = date.getHours();if (!hourlyAverages[hour]) {hourlyAverages[hour] = {customers: [],passersby: [],captureRates: []};}const customers = parseInt(row[columnMap['Customers']]) || 0;const passersby = parseInt(row[columnMap['Passersby']]) || 0;const captureRate = calculateCaptureRate(customers, passersby);hourlyAverages[hour].customers.push(customers);hourlyAverages[hour].passersby.push(passersby);hourlyAverages[hour].captureRates.push(parseFloat(captureRate));}});const hours = Object.keys(hourlyAverages).sort((a,b) => a-b);const avgCustomers = hours.map(hour => {const sum = hourlyAverages[hour].customers.reduce((a,b) => a+b, 0);return sum / hourlyAverages[hour].customers.length;});const avgPassersby = hours.map(hour => {const sum = hourlyAverages[hour].passersby.reduce((a,b) => a+b, 0);return sum / hourlyAverages[hour].passersby.length;});const avgCaptureRate = hours.map(hour => {const sum = hourlyAverages[hour].captureRates.reduce((a,b) => a+b, 0);return sum / hourlyAverages[hour].captureRates.length;});const ctx = document.getElementById('weekdayChart').getContext('2d');if (window.weekdayChart instanceof Chart) {window.weekdayChart.destroy();} const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];window.weekdayChart = new Chart(ctx, {data: {labels: hours.map(h => `${h}:00`),datasets: [{type: 'bar',label: 'Average Customers',data: avgCustomers,backgroundColor: 'rgba(47, 118, 34, 0.5)',borderColor: '#2f7622',yAxisID: 'y-customers',},{type: 'line',label: 'Average Passersby',data: avgPassersby,borderColor: '#f39700',borderWidth: 2,fill: false,yAxisID: 'y-passersby',},{type: 'line',label: 'Average Capture Rate (%)',data: avgCaptureRate,borderColor: '#c5d469',borderWidth: 2,fill: false,yAxisID: 'y-capture',}]},options: {responsive: true,maintainAspectRatio: false,plugins: {datalabels: {display: false},title: {display: true,text: `Average Traffic for ${weekdays[selectedDay]}`}}},scales: {'y-customers': {type: 'linear',position: 'left',title: {display: true,text: 'Customers'}},'y-passersby': {type: 'linear',position: 'right',title: {display: true,text: 'Passersby'}},'y-capture': {type: 'linear',position: 'right',title: {display: true,text: 'Capture Rate (%)'},min: 0,grid: {drawOnChartArea: false}}}}); }function showMessage(message, type) {console.log(`${type}: ${message}`);const messageDiv = document.getElementById('message');if (messageDiv) {messageDiv.className = 'message ' + type;messageDiv.textContent = message;}}function switchTab(tabId) {document.querySelectorAll('.tab-content').forEach(tab => {tab.classList.remove('active');});document.querySelectorAll('.tab-button').forEach(button => {button.classList.remove('active');});document.getElementById(tabId).classList.add('active');document.querySelector(`[data-tab="${tabId.replace('Tab', '')}"]`).classList.add('active');window.dispatchEvent(new Event('resize'));}function updateTimeCaptureChart(selectedDate) {const timeRanges = {morning: { start: 7, end: 10, label: 'Morning', color: 'rgba(47, 118, 34, 0.8)' }, noon: { start: 12, end: 14, label: 'Noon', color: 'rgba(243, 151, 0, 0.8)' }, afternoon: { start: 16, end: 20, label: 'Afternoon', color: '#f39700' }, custom: { start: parseInt(document.getElementById('startHourRange').value), end: parseInt(document.getElementById('endHourRange').value), label: 'Custom', color: '#af9e50' } }; const captureRates = {}; Object.entries(timeRanges).forEach(([period, range]) => { let totalCustomers = 0; let totalPassersby = 0; rawData.forEach(row => { const date = new Date(row[0]); const datePart = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`; const hour = date.getHours(); if (datePart === selectedDate && hour >= range.start && hour <= range.end && isWithinOpeningHours(date, hour)) { totalCustomers += getValue('Customers', row); totalPassersby += getValue('Passersby', row); } }); const captureRate = calculateCaptureRate(totalCustomers, totalPassersby); captureRates[period] = { rate: captureRate, label: `${range.label} (${range.start}:00-${range.end}:00): ${captureRate}%`, color: range.color }; const rateElement = document.getElementById(`${period}Rate`); if (rateElement) { rateElement.textContent = `${captureRate}%`; } }); const ctx = document.getElementById('timeCapturePieChart').getContext('2d'); if (timeCaptureChart instanceof Chart) { timeCaptureChart.destroy(); } timeCaptureChart = new Chart(ctx, { type: 'pie', data: { labels: Object.values(captureRates).map(cr => cr.label), datasets: [{ data: Object.values(captureRates).map(cr => cr.rate), backgroundColor: Object.values(captureRates).map(cr => cr.color), borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false }, datalabels: { color: '#fff', font: { weight: 'bold', size: 14 }, formatter: (value) => { if (!value || isNaN(value)) return '0%'; return parseFloat(value).toFixed(1) + '%'; }, anchor: 'center', align: 'center' } } } }); } </script></body></html>